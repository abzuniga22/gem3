{% extends 'base.html' %}
{% block title %}Model {{ m['model'] }} â€“ GEM3{% endblock %}
{% block content %}
<h2>{{ m['model'] }}</h2>
<p class="muted">
  Organism: {{ m['organism'] }} |
  Type: {{ m['pro_euk'] }} |
  Respiration: {{ m['respiration'] }} |
  Cell type: {{ m['cell_type'] }}
  {% set p = paper_url(m['model']) %}
  {% if p %} | Reference: <a href="{{ p }}" target="_blank" rel="noopener">paper</a>{% endif %}
</p>

<h3>Overview</h3>
<ul>
  <li>Reactions: {{ n_rxn }}</li>
  <li>Metabolites: {{ n_met }}</li>
  <li>Genes: {{ n_gene }}</li>
</ul>

<h3>Reactions</h3>
<table>
  <tr><th>ID</th><th>Equation</th><th>Pathway</th></tr>
  {% for r in reactions %}
  <tr>
    <td>{{ r['reaction_id'] | autolink }}</td>
    <td>{{ r['equation']   | autolink }}</td>
    <td>{{ r['pathway']    | autolink }}</td>
  </tr>
  {% endfor %}
</table>
{% if rpages > 1 %}
  <div class="muted">
    Page {{ rpage }} of {{ rpages }}
    {% if rpage > 1 %}
      <a href="{{ url_for('model_detail', model=m['model'], rpage=1,       mpage=mpage, gpage=gpage) }}">First</a>
      <a href="{{ url_for('model_detail', model=m['model'], rpage=rpage-1, mpage=mpage, gpage=gpage) }}">Prev</a>
    {% endif %}
    {% if rpage < rpages %}
      <a href="{{ url_for('model_detail', model=m['model'], rpage=rpage+1, mpage=mpage, gpage=gpage) }}">Next</a>
      <a href="{{ url_for('model_detail', model=m['model'], rpage=rpages,  mpage=mpage, gpage=gpage) }}">Last</a>
    {% endif %}
  </div>
{% endif %}

<h3>Metabolites</h3>
<table>
  <tr><th>ID</th><th>Name</th><th>Formula</th><th>Compartment</th></tr>
  {% for mt in metabolites %}
  <tr>
    <td>{{ mt['metabolite_id'] | autolink }}</td>
    <td>{{ mt['name']          | autolink }}</td>
    <td>{{ mt['formula'] }}</td>
    <td>{{ mt['compartment'] }}</td>
  </tr>
  {% endfor %}
</table>
{% if mpages > 1 %}
  <div class="muted">
    Page {{ mpage }} of {{ mpages }}
    {% if mpage > 1 %}
      <a href="{{ url_for('model_detail', model=m['model'], rpage=rpage, mpage=1,        gpage=gpage) }}">First</a>
      <a href="{{ url_for('model_detail', model=m['model'], rpage=rpage, mpage=mpage-1,  gpage=gpage) }}">Prev</a>
    {% endif %}
    {% if mpage < mpages %}
      <a href="{{ url_for('model_detail', model=m['model'], rpage=rpage, mpage=mpage+1,  gpage=gpage) }}">Next</a>
      <a href="{{ url_for('model_detail', model=m['model'], rpage=rpage, mpage=mpages,   gpage=gpage) }}">Last</a>
    {% endif %}
  </div>
{% endif %}

<h3>Genes</h3>
<table>
  <tr><th>ID</th><th>Protein</th></tr>
  {% for g in genes %}
  <tr>
    <td>{{ g['gene_id'] | autolink }}</td>
    <td>{{ g['protein'] | autolink }}</td>
  </tr>
  {% endfor %}
</table>
{% if gpages > 1 %}
  <div class="muted">
    Page {{ gpage }} of {{ gpages }}
    {% if gpage > 1 %}
      <a href="{{ url_for('model_detail', model=m['model'], rpage=rpage, mpage=mpage, gpage=1) }}">First</a>
      <a href="{{ url_for('model_detail', model=m['model'], rpage=rpage, mpage=mpage, gpage=gpage-1) }}">Prev</a>
    {% endif %}
    {% if gpage < gpages %}
      <a href="{{ url_for('model_detail', model=m['model'], rpage=rpage, mpage=mpage, gpage=gpage+1) }}">Next</a>
      <a href="{{ url_for('model_detail', model=m['model'], rpage=rpage, mpage=mpage, gpage=gpages) }}">Last</a>
    {% endif %}
  </div>
{% endif %}

<!-- Model file downloads (only .xml/.mat/.json) -->
<section style="margin-top:1rem;">
  <h3>Available Model Files</h3>
  {% if model_groups %}
    {% for model_name, files in model_groups %}
      <details>
        <summary><strong>{{ model_name }}</strong></summary>
        <ul>
          {% for file_name, href in files %}
            <li><a href="{{ href }}" download>{{ file_name }}</a></li>
          {% endfor %}
        </ul>
      </details>
    {% endfor %}
  {% else %}
    <p class="muted">No model files found. Add .xml/.mat/.json files to <code>static/models/</code>.</p>
  {% endif %}
</section>
{% endblock %}
